/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var E=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var H=(t,e)=>{for(var r in e)E(t,r,{get:e[r],enumerable:!0})},D=(t,e,r,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of _(e))!R.call(t,o)&&o!==r&&E(t,o,{get:()=>e[o],enumerable:!(s=T(e,o))||s.enumerable});return t};var L=t=>D(E({},"__esModule",{value:!0}),t);var z={};H(z,{default:()=>v});module.exports=L(z);var M=require("obsidian");var u=class{constructor(e){this.regExp=e}test(e){return this.regExp.test(e)}getHeader(e){var o;let r=this.regExp.exec(e),s=(o=r==null?void 0:r.groups)!=null?o:{};return{user:s.user,date:s.date,year:s.year,time:s.time}}};function I(t){return t===null||void 0||(t==null?void 0:t.trim().length)===0}function l(t){return!I(t)}function N(t){let e={};if(l(t)){let r=/(?<parameter>[a-z]*): (?<value>.*)/i;t==null||t.split(`
`).filter(l).forEach(s=>{var o;if(r.test(s)){let n=r.exec(s),a=(o=n==null?void 0:n.groups)!=null?o:{};e[a.parameter]=a.value}})}return e}function x(t){var e;if(t.includes("---")){let r=t.split("---"),s=N(r[0]?r[0].trim():void 0),o=r[1]?r[1].trim():"";if(o==null)throw new Error("The second part is required.");let n="telegram";return((e=s.view)!=null?e:"").trim()==="dialog"&&(n="dialog"),{view:n,source:o}}return{view:"telegram",source:t}}function b(t){let e=t.trim().split(" ");if(e.length===1)return e[0].substring(0,2).toUpperCase();let r=e[0].charAt(0).toUpperCase(),s=e[e.length-1].charAt(0).toUpperCase();return`${r}${s}`}function C(t){return t>="A"&&t<="Z"?t.charCodeAt(0)-65+1:t>="\u0410"&&t<="\u042F"?t.charCodeAt(0)-1040+1:0}function w(t,e){if(t.length!==1||e.length!==1)throw new Error("Both inputs must be single letters.");let r=C(t.toUpperCase())*10%256,s=C(e.toUpperCase())*10%256,o=(r+s)/2;return`#${((1<<24)+(r<<16)+(s<<8)+Math.round(o)).toString(16).slice(1).toUpperCase()}`}function S(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:null}function V(t){let[e,r,s]=t.map(o=>o/255);return .2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))}function y(t){let e=S(t);if(!e)throw new Error("Invalid hex color format");return V(e)>.5?"#000000":"#FFFFFF"}var p=class{constructor(e){this.headerParser=e}parse(e){let r=[],s=null,o=[];for(let n of e.split(`
`).filter(l)){if(this.headerParser.test(n)){s!==null&&(r.push({header:s,messages:o}),s=null,o=[]),s=this.headerParser.getHeader(n);continue}s&&o.push(n.trim())}return s!==null&&r.push({header:s,messages:o}),r}};var f=class extends p{constructor(r){super(r);this.headerParser=r}parse(r){let s=r.replace(/^([a-zа-я ]*:)/gim,`$1
`);return super.parse(s)}};var m=class m{static create(e){if(e==="telegram"){let r=new u(m.TELEGRAM_HEADER_PATTERN);return new p(r)}if(e==="dialog"){let r=new u(m.DIALOG_PATTERN);return new f(r)}throw new Error(`Unexpected value: ${e}`)}};m.TELEGRAM_HEADER_PATTERN=/^(?<user>[ A-Za-zА-Яа-яЁё0-9]+),\s\[([0-9]+\s[0-9]+\sviews, )?(?<date>[0-9]+\s+[A-Za-zА-Яа-я.]+)\s(?<year>[0-9]+)\s*г\.\s*,\s*(?<time>[0-9]{2}:[0-9]{2}:[0-9]{2})/,m.DIALOG_PATTERN=/(?<user>[a-zа-я ]*):/i;var g=m;var h=class{constructor(e,r,s){var n;let o=g.create((n=s.view)!=null?n:"telegram");this.parent=r,this.messages=o.parse(e),this.render(),this.parent.onscroll=()=>{let a=this.parent.querySelectorAll(".month-day");for(let i=0;i<a.length-1;i++){let c=a[i],d=a[i+1];c.offsetTop>=d.offsetTop-16?(d.setCssProps({visibility:"visible"}),c.setCssProps({visibility:"hidden"})):c.setCssProps({visibility:"visible"})}}}render(){let e=new Set;this.parent.className="chat";let r=!1;for(let s of this.messages){let{user:o,date:n,time:a}=s.header;n&&!e.has(n)&&(this.parent.createDiv({cls:"month-day"}).createDiv({cls:"month-day__title",text:n}),e.add(n));let i=b(o),c=this.parent.createDiv({cls:"header"}),d=w(i[0],i[1]);c.createDiv({cls:"header__abbr",text:i}).setCssProps({"background-color":d,color:y(d)});let A=c.createDiv({cls:"header__title"});A.createDiv({cls:"header__user",text:o}).setCssProps({color:d}),A.createDiv({cls:"header__time",text:a});for(let P of s.messages)this.parent.createDiv({cls:"message",text:P});r=!0}r||this.parent.createDiv({cls:"error",text:"\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u043E\u0442\u043E\u0431\u0440\u0430\u0437\u0438\u0442\u044C \u0447\u0430\u0442"})}};var v=class extends M.Plugin{constructor(e,r){super(e,r)}async onload(){await this.loadData(),this.registerMarkdownCodeBlockProcessor("chat",(e,r)=>{let{view:s,source:o}=x(e);new h(o,r,{view:s})})}};
